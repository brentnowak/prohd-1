<?phpclass APIOrders extends EVEXMLData{	public function apiAttributes()	{		return array(			'url'=>'http://api.eve-online.com/char/MarketOrders.xml.aspx',			'cacheID'=>'APIOrders',			'primaryID'=>'characterID',			'keys'=>array('keyID','vCode','characterID'),			'storageTable'=>'orders'		);	}	public function storeData($walletID)	{		$attributes = $this->apiAttributes();				//Retrieve the XML dataset		$orders = $this->getEVEData($walletID);				$character = Characters::Model()->findByPk($walletID);		Orders::Model()->deleteAll('charID=:charID',array(':charID'=>$character->characterID));				foreach ($orders->result->rowset->row as $row)		{			$exist = Orders::Model()->exists('orderID=:orderID',array(':orderID'=>$row->attributes()->orderID));			if(!$exist)			{				//echo "ORDERID: {$row->attributes()->orderID} <br>";				//print_r($row->attributes());								$orderRow = new Orders;				$orderRow->orderID = (int) $row->attributes()->orderID;				$orderRow->charID = (int) $row->attributes()->charID;				$orderRow->stationID = (int) $row->attributes()->stationID;				$orderRow->volEntered = (int) $row->attributes()->volEntered;				$orderRow->volRemaining = (int) $row->attributes()->volRemaining;				$orderRow->minVolume = (int) $row->attributes()->minVolume;				$orderRow->orderState = (int) $row->attributes()->orderState;				$orderRow->typeID = (int) $row->attributes()->typeID;				$orderRow->range = (int) $row->attributes()->range;				$orderRow->accountKey = (int) $row->attributes()->accountKey;				$orderRow->duration = (int) $row->attributes()->duration;				$orderRow->escrow = $row->attributes()->escrow;				$orderRow->price = $row->attributes()->price;				$orderRow->bid = (int) $row->attributes()->bid;				$orderRow->issued = $row->attributes()->issued;				$orderRow->save();								//print_r($orderRow->getErrors());				if (count($orderRow->getErrors()) > 0) Yii::log(print_r($orderRow->getErrors(), true), "warning", "APIOrders");						}			else			{				//echo "ORDERID: {$row->attributes()->orderID} <br>";								$orderRow = Orders::Model()->findByPk($row->attributes()->orderID);				$orderRow->orderID = (int) $row->attributes()->orderID;				$orderRow->charID = (int) $row->attributes()->charID;				$orderRow->stationID = (int) $row->attributes()->stationID;				$orderRow->volEntered = (int) $row->attributes()->volEntered;				$orderRow->volRemaining = (int) $row->attributes()->volRemaining;				$orderRow->minVolume = (int) $row->attributes()->minVolume;				$orderRow->orderState = (int)  $row->attributes()->orderState;				$orderRow->typeID = (int) $row->attributes()->typeID;				$orderRow->range = (int) $row->attributes()->range;				$orderRow->accountKey = (int) $row->attributes()->accountKey;				$orderRow->duration = (int) $row->attributes()->duration;				$orderRow->escrow = $row->attributes()->escrow;				$orderRow->price = $row->attributes()->price;				$orderRow->bid = (int) $row->attributes()->bid;				$orderRow->issued = $row->attributes()->issued;				$orderRow->save();								//print_r($orderRow->getErrors());				if (count($orderRow->getErrors()) > 0) Yii::log(print_r($orderRow->getErrors(), true), "warning", "APIOrders");			}		}	}}?>